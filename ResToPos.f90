!__doc__   openfile = x.res
!__doc__   writefile = POSCAR
!__doc__   it is a minor program for my own linux VASP 
!__doc__   FORTRAN version
!__doc__   TITL Mg
!__doc__   CELL   0.0000   3.2100   3.2100   5.2100  90.0000  90.0000 120.0000
!__doc__   LATT -1
!__doc__   SFAC Mg
!__doc__   MG1   1    0.66667    0.33333    0.75000    1.00000   0.00000
!__doc__   MG2   1    0.33333    0.66667    0.25000    1.00000   0.00000
!__doc__   END
IMPLICIT NONE
REAL   ::L(3),LATT(3,3),ANGLE(3),C1,C2,C3
REAL   ::TEMP_R,SIND,COSD
INTEGER,ALLOCATABLE:: EACH_ATOM_NUM(:)
INTEGER  ::N_TYPE,TOT_N_ATOM,I,J
CHARACTER*20  ::TEMP_C
CHARACTER*5,ALLOCATABLE::N_ELEMENT(:)
TYPE ATOM_INFO
INTEGER  :: N_ATOM
INTEGER  :: ELEMENT_TYPE
REAL     :: POS(3)
END TYPE
TYPE(ATOM_INFO),ALLOCATABLE::ATOM(:)
OPEN(111,FILE="x.res")
OPEN(112,FILE="POSCAR")
!--------------------part for reading x.res----------------------------
READ(111,*)
READ(111,*)TEMP_C,TEMP_R,L(1),L(2),L(3),ANGLE(1),ANGLE(2),ANGLE(3)
WRITE(*,*)L(1),L(2),L(3),ANGLE(1),ANGLE(2),ANGLE(3)
READ(111,*)
LATT(1,:)=L(1)*(/1,0,0/)
LATT(2,:)=L(2)*(/COSD(ANGLE(3)),SIND(ANGLE(3)),0/)
C1=L(3)*(COSD(ANGLE(2)))
C2=L(3)*(COSD(ANGLE(1))-COSD(ANGLE(2))*COSD(ANGLE(3)))/SIND(ANGLE(3))
C3=L(3)*SQRT(1+2*COSD(ANGLE(1))*COSD(ANGLE(2))*COSD(ANGLE(3))-(COSD(ANGLE(1)))**2-(COSD(ANGLE(2)))**2-(COSD(ANGLE(3)))**2)/SIND(ANGLE(3))
LATT(3,:)=(/C1,C2,C3/)
WRITE(*,*) "Plz input the number of atom type:"
READ(*,*)N_TYPE
ALLOCATE(N_ELEMENT(N_TYPE))
READ(111,*)TEMP_C,N_ELEMENT(:)
WRITE(*,*)N_ELEMENT(:)
WRITE(*,*)"Plz input the total number of atoms:"
READ(*,*)TOT_N_ATOM
ALLOCATE(ATOM(TOT_N_ATOM))
ALLOCATE(EACH_ATOM_NUM(N_TYPE))
DO I=1,TOT_N_ATOM
READ(111,*)TEMP_C,ATOM(I).ELEMENT_TYPE,ATOM(I).POS(:)
ENDDO
DO I=1,N_TYPE
DO J=1,TOT_N_ATOM
IF (ATOM(J).ELEMENT_TYPE==I) WRITE(*,*) ATOM(J).ELEMENT_TYPE, ATOM(J).POS
ENDDO
ENDDO
EACH_ATOM_NUM=0
WRITE(*,*)
WRITE(*,*)
DO I=1,N_TYPE
DO J=1,TOT_N_ATOM
IF(ATOM(J).ELEMENT_TYPE==I) THEN
EACH_ATOM_NUM(I)=EACH_ATOM_NUM(I)+1
END IF
ENDDO
ENDDO
!-------------part for writing POSCAR---------------
WRITE(112,'(11A)') "SYSTEM=CELL"
WRITE(112,'(5A)')"1.000"
DO I=1,3
WRITE(112,"(f11.8,f15.8,f15.8)")LATT(I,:)
ENDDO
WRITE(112,"(100(I2))")EACH_ATOM_NUM(:)
WRITE(112,'(6A)')"DIRECT"
DO I=1,N_TYPE
DO J=1,TOT_N_ATOM
IF (ATOM(J).ELEMENT_TYPE==I) WRITE(112,"(f10.8,f15.8,f15.8 )") ATOM(J).POS
ENDDO
ENDDO
END



